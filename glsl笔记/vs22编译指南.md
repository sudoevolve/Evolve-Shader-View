# ✅ Evolve Shader — Visual Studio 2022 使用手册  
> 基于 `vcpkg` 管理依赖 · 支持热重载/交互式配置

---

## 🧩 项目概览

| 项目名称       | `Evolve Shader` |
|----------------|------------------|
| 构建工具       | Visual Studio 2022 (.sln + .vcxproj) |
| C++ 标准       | C++17 或更高 |
| 图形 API       | OpenGL 3.3 Core Profile |
| 外部依赖       | GLFW, GLAD, stb_image (via vcpkg) |
| 主要功能       | 多 pass 渲染、Shadertoy 兼容语法、图像输入、反馈效果 |

---

## 📁 目录结构建议（推荐）

确保你的项目目录如下：

```
EvolveShader/
│
├── Evolve Shader.sln
├── Evolve Shader/
│   ├── main.cpp
│   └── resource.h (可选)
│
├── frag/              ← 存放 .frag 片段着色器
│   ├── 0_base.frag
│   ├── 1_blur.frag
│   └── 2_feedback.frag
│
├── iChannel/          ← 可选：纹理资源目录
│   ├── test.jpg
│   └── textures/pattern.png
│
└── external/          ← 可选：本地拷贝或符号链接（非必需）
```

> ⚠️ 注意：
> - `frag/` 和 `iChannel/` 必须与 `.exe` 输出路径在同一级（通常是 `Debug/` 或 `Release/` 同级）。
> - 编译后请将这些文件夹复制到输出目录，否则程序找不到它们！

---

## 🔧 vcpkg 依赖安装（已自动补全？验证一下）

虽然你说“头文件都是 vcpkg 自动补全”，但为了确保万无一失，请确认以下库已正确安装：

```bash
# 打开终端（如 x64 Native Tools Command Prompt）
vcpkg install glfw3 --triplet=x64-windows
vcpkg install glad --triplet=x64-windows
vcpkg install stb-image --triplet=x64-windows
```

> ✅ 如果你在 `#include <glad/glad.h>` 和 `<GLFW/glfw3.h>` 上没有红线，则说明集成成功。

### ✔ 检查 VS2022 中是否启用 vcpkg

1. 打开项目属性 → **VC++ Directories**
2. 查看 `Include Directories` 是否包含类似：
   ```
   $(VCPKG_ROOT)\installed\x64-windows\include
   ```
3. 库目录是否包含：
   ```
   $(VCPKG_ROOT)\installed\x64-windows\lib
   ```
4. 链接器输入添加了：
   ```
   glfw3.lib
   opengl32.lib
   ```

> 💡 提示：如果你用的是 **vcpkg integrate install**，Visual Studio 会自动注入这些路径。

---

## 🛠️ 项目配置要点（VS2022 设置）

右键点击项目 → “属性” → 进行如下设置：

| 配置项 | 值 |
|-------|-----|
| **C/C++ → General → Additional Include Directories** | 添加 `stb_image.h` 所在目录（如果没被 vcpkg 覆盖） |
| **Linker → Input → Additional Dependencies** | `glfw3.lib; opengl32.lib` |
| **Linker → General → Additional Library Directories** | 自动由 vcpkg 注入，无需手动添加 |
| **C/C++ → Language → C++ Language Standard** | `ISO C++17 Standard (/std:c++17)` |
| **Runtime Library** | `/MT`（静态链接 CRT）或 `/MD`（动态），推荐 `/MD` 配合 vcpkg 默认行为 |

---

## ▶️ 如何运行？

1. 编译项目（F7）
2. 确保 `frag/` 和 `iChannel/` 文件夹存在于 **可执行文件旁边**

   ```
   Build Output Path:
   EvolveShader/x64/Debug/
   ├── Evolve Shader.exe
   ├── frag/
   └── iChannel/
   ```

3. 按 F5 或 Ctrl+F5 启动程序

---

## 🎮 启动后的交互流程

程序启动后会在控制台打印信息：

```
Found 3 shader(s):
  [0] 0_base.frag
  [1] 1_blur.frag
  [2] 2_feedback.frag

Found 2 global image(s):
  [0] test.jpg
  [1] pattern.png

=== Interactive iChannel Setup ===
 Press Enter for auto-chain (buffer0 → buffer1 → ...),
 or type a buffer index to configure manually: 
```

### ✅ 推荐操作：

- 直接按回车 → 使用自动链式连接：  
  `0_base → 1_blur → 2_feedback`

- 若想手动配置某个 pass 的输入（比如让 `buffer2` 使用一张图作为贴图），输入编号如 `2`，然后选择对应 channel 来源。

---



## 🧪 调试技巧（VS22 环境下）

### 1. 查看 OpenGL 错误日志
所有着色器编译错误都会输出到 **Visual Studio 的“输出”窗口**（Output Window）。

例如：
```
Fragment shader compile error:
ERROR: 0:10: 'iResoluton' : undeclared identifier
```

👉 快速定位语法错误。

### 2. 断点调试
可以在 `main()` 函数、`LoadShaderFile()` 或 `ConfigureChannelsInteractively()` 处打断点，检查变量值。

### 3. 实时修改 `.frag` 文件
✅ 支持热重载！  
关闭程序 → 修改 `.frag` → 重新运行即可看到新效果（无需重新编译 C++ 代码）。

---

## 📦 发布你的作品

当你完成一个视觉效果，想要打包分享：

1. 将以下内容打包在一起：
   - `Evolve Shader.exe`
   - `frag/` 文件夹
   - `iChannel/` 文件夹（如有）
   - `opengl32.dll` 不需要（系统自带）
   - 但需确保目标电脑有显卡驱动支持 OpenGL 3.3+

2. （可选）使用工具如 [Enigma Virtual Box](https://enigmaprotector.com/en/virtualbox.html) 打包成单文件 `.exe`

---

## ❓常见问题 FAQ

### Q1: 程序一闪而过？
> A: 因为没找到 `frag/` 目录。请把 `frag/` 放在 `.exe` 同级目录！

### Q2: 显示黑屏？
> A: 检查 `.frag` 是否正确定义了 `mainImage(...)`；是否有语法错误（看控制台输出）。

### Q3: 报错 “Failed to create window”
> A: 显卡不支持 OpenGL 3.3。尝试更新驱动或换设备。

### Q4: 图像加载失败？
> A: `iChannelResolution[]` 可能为空。确保图片路径正确，且格式是 `.png/.jpg`。

---

## 📜 总结

你现在拥有的是一个强大的 **可视化编程沙盒工具**，非常适合用于：

- 学习 GLSL 和多 pass 渲染
- 制作实时生成艺术（Generative Art）
- 开发 VJ 工具原型
- 教学演示图形管线概念

---

🎉 **Happy Shading!**  
用代码绘制属于你的宇宙光影吧！

--- 

📌 *文档版本：v1.1 · 更新于 2025 年 9 月 15* 
🔧 维护建议：保留此文档在项目根目录 `README.md` 或 `docs/` 中方便团队协作。